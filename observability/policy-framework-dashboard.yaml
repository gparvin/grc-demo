kind: ConfigMap
apiVersion: v1
metadata:
  name: policy-framework-dashboard
  namespace: open-cluster-management-observability
  annotations:
    observability.open-cluster-management.io/dashboard-folder: Custom
  labels:
    grafana-custom-dashboard: "true"
data:
  policy-framework-dashboard.json: |
    {"annotations": {"list": [{"builtIn": 1, "datasource": "-- Grafana --", "enable": true, "hide": true, "iconColor": "rgba(0, 211, 255, 1)", "name": "Annotations & Alerts", "target": {"limit": 100, "matchAny": false, "tags": [], "type": "dashboard"}, "type": "dashboard"}]}, "editable": true, "gnetId": null, "graphTooltip": 0, "id": 26, "iteration": 1677541620103, "links": [], "panels": [{"datasource": null, "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"hideFrom": {"legend": false, "tooltip": false, "viz": false}}, "mappings": []}, "overrides": []}, "gridPos": {"h": 8, "w": 6, "x": 0, "y": 0}, "id": 14, "options": {"legend": {"displayMode": "list", "placement": "bottom"}, "pieType": "pie", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "tooltip": {"mode": "single"}}, "pluginVersion": "8.1.3", "targets": [{"exemplar": true, "expr": "count(policy_governance_info{type=\"root\"} == 0)", "hide": false, "instant": true, "interval": "", "legendFormat": "Compliant Policies", "refId": "B"}, {"exemplar": true, "expr": "count(policy_governance_info{type=\"root\"} == 1)", "hide": false, "instant": true, "interval": "", "legendFormat": "NonCompliant Policies", "refId": "C"}], "title": "Root Policies", "type": "piechart"}, {"datasource": null, "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"hideFrom": {"legend": false, "tooltip": false, "viz": false}}, "mappings": []}, "overrides": []}, "gridPos": {"h": 8, "w": 6, "x": 6, "y": 0}, "id": 16, "options": {"legend": {"displayMode": "list", "placement": "bottom"}, "pieType": "pie", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "tooltip": {"mode": "single"}}, "targets": [{"exemplar": true, "expr": "count(policy_governance_info{type=\"propagated\"} == 0)", "hide": false, "instant": false, "interval": "", "legendFormat": "Compliant Propagated", "refId": "B"}, {"exemplar": true, "expr": "count(policy_governance_info{type=\"propagated\"} == 1)", "instant": false, "interval": "", "legendFormat": "NonCompliant Propagated", "refId": "A"}], "title": "Propagated Policies", "type": "piechart"}, {"datasource": null, "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 0, "gradientMode": "none", "hideFrom": {"legend": false, "tooltip": false, "viz": false}, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 5, "scaleDistribution": {"type": "linear"}, "showPoints": "auto", "spanNulls": false, "stacking": {"group": "A", "mode": "none"}, "thresholdsStyle": {"mode": "off"}}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}, {"color": "red", "value": 80}]}}, "overrides": []}, "gridPos": {"h": 8, "w": 12, "x": 12, "y": 0}, "id": 8, "options": {"legend": {"calcs": [], "displayMode": "list", "placement": "bottom"}, "tooltip": {"mode": "single"}}, "targets": [{"exemplar": true, "expr": "sum(kube_pod_container_status_restarts_total{container=\"config-policy-controller\"})", "instant": false, "interval": "", "legendFormat": "Config Policy Controller Restarts", "refId": "Config policy restarts"}, {"exemplar": true, "expr": "sum(kube_pod_container_status_restarts_total{container=\"governance-policy-framework-addon\"})", "hide": false, "instant": false, "interval": "", "legendFormat": "Governance Framework Restarts", "refId": "Governance framework restarts"}], "title": "Restarting Pods", "type": "timeseries"}, {"datasource": null, "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 0, "gradientMode": "none", "hideFrom": {"legend": false, "tooltip": false, "viz": false}, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 5, "scaleDistribution": {"type": "linear"}, "showPoints": "auto", "spanNulls": false, "stacking": {"group": "A", "mode": "none"}, "thresholdsStyle": {"mode": "off"}}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}, {"color": "red", "value": 80}]}}, "overrides": []}, "gridPos": {"h": 8, "w": 12, "x": 0, "y": 8}, "id": 20, "options": {"legend": {"calcs": [], "displayMode": "list", "placement": "bottom"}, "tooltip": {"mode": "single"}}, "targets": [{"exemplar": true, "expr": "count(policy_governance_info{type=\"root\"} == 1)", "instant": false, "interval": "", "legendFormat": "NonCompliant Policies", "refId": "A"}, {"exemplar": true, "expr": "count(policy_governance_info{type=\"root\"})", "hide": false, "instant": false, "interval": "", "legendFormat": "Total Policies", "refId": "B"}], "title": "Root Policy Compliance", "type": "timeseries"}, {"datasource": null, "description": "View the work queue and the queue depth", "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 0, "gradientMode": "none", "hideFrom": {"legend": false, "tooltip": false, "viz": false}, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 5, "scaleDistribution": {"type": "linear"}, "showPoints": "auto", "spanNulls": false, "stacking": {"group": "A", "mode": "none"}, "thresholdsStyle": {"mode": "off"}}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}, {"color": "red", "value": 80}]}}, "overrides": []}, "gridPos": {"h": 9, "w": 12, "x": 12, "y": 8}, "id": 2, "options": {"legend": {"calcs": [], "displayMode": "list", "placement": "bottom"}, "tooltip": {"mode": "single"}}, "targets": [{"exemplar": true, "expr": "sum(avg_over_time(workqueue_depth{name=\"policy-status-sync\"}[15m]))", "hide": false, "instant": false, "interval": "", "legendFormat": "Work Queue Depth", "refId": "Status Sync Queue Depth"}, {"exemplar": true, "expr": "sum(delta(controller_runtime_reconcile_total{controller=\"policy-status-sync\"}[15m]))", "hide": false, "instant": false, "interval": "", "legendFormat": "Total Reconciles", "refId": "Status Sync Reconciles"}, {"exemplar": true, "expr": "sum(increase(controller_runtime_reconcile_errors_total{controller=\"policy-status-sync\"}[15m]))", "hide": false, "instant": false, "interval": "", "legendFormat": "Failed Reconciles", "refId": "Status Sync Reconcile Errors"}], "title": "Status Sync Health", "type": "timeseries"}, {"datasource": "${datasource}", "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "custom": {"align": "auto", "displayMode": "auto"}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}, {"color": "red", "value": 80}]}}, "overrides": [{"matcher": {"id": "byName", "options": "cluster_namespace"}, "properties": [{"id": "displayName", "value": "Cluster"}, {"id": "links", "value": [{"title": "Cluster drill down", "url": "/d/09ec8aa1e996d6ffcd6817bbaff4db1b/kubernetes-api-server?var-cluster=${__data.fields.cluster_namespace}&var-instance=All"}]}]}, {"matcher": {"id": "byName", "options": "Value #A"}, "properties": [{"id": "displayName", "value": "Percent Compliant"}, {"id": "unit", "value": "percentunit"}]}, {"matcher": {"id": "byName", "options": "Value #C"}, "properties": [{"id": "displayName", "value": "Total Policies"}]}, {"matcher": {"id": "byName", "options": "Value #B"}, "properties": [{"id": "displayName", "value": "Percent NonCompliant"}, {"id": "unit", "value": "percentunit"}, {"id": "thresholds", "value": {"mode": "absolute", "steps": [{"color": "green", "value": null}, {"color": "#EAB839", "value": 0.001}, {"color": "red", "value": 0.05}]}}, {"id": "custom.displayMode", "value": "color-background-solid"}]}, {"matcher": {"id": "byName", "options": "Value #D"}, "properties": [{"id": "displayName", "value": "NonCompliant Policies"}]}]}, "gridPos": {"h": 8, "w": 12, "x": 0, "y": 16}, "id": 12, "options": {"showHeader": true, "sortBy": [{"desc": true, "displayName": "Percent NonCompliant"}]}, "pluginVersion": "8.1.3", "targets": [{"exemplar": true, "expr": "count(policy_governance_info{type=\"propagated\"} == 0) by (cluster_namespace) / count(policy_governance_info{type=\"propagated\"}) by (cluster_namespace)", "format": "table", "instant": true, "interval": "", "legendFormat": "", "refId": "A"}, {"exemplar": true, "expr": "count(policy_governance_info{type=\"propagated\"} == 1) by (cluster_namespace) / count(policy_governance_info{type=\"propagated\"}) by (cluster_namespace)", "format": "table", "hide": false, "instant": true, "interval": "", "legendFormat": "", "refId": "B"}, {"exemplar": true, "expr": "count(policy_governance_info{type=\"propagated\"}) by (cluster_namespace)", "format": "table", "hide": false, "interval": "", "legendFormat": "", "refId": "C"}, {"exemplar": true, "expr": "count(policy_governance_info{type=\"propagated\"} == 1) by (cluster_namespace)", "format": "table", "hide": false, "instant": false, "interval": "", "legendFormat": "", "refId": "D"}], "title": "Propagated Policy Compliance", "transformations": [{"id": "seriesToColumns", "options": {"byField": "cluster_namespace"}}, {"id": "organize", "options": {"excludeByName": {"Time": true, "{cluster_namespace=\"development\"}": false}, "indexByName": {"Time": 5, "Value #A": 4, "Value #B": 3, "Value #C": 1, "Value #D": 2, "cluster_namespace": 0}, "renameByName": {"Value": ""}}}, {"id": "labelsToFields", "options": {}}], "type": "table"}, {"datasource": null, "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "custom": {"align": "auto", "displayMode": "auto"}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}, {"color": "red", "value": 80}]}}, "overrides": [{"matcher": {"id": "byName", "options": "cluster"}, "properties": [{"id": "displayName", "value": "Cluster"}, {"id": "links", "value": [{"title": "Cluster", "url": "/d/09ec8aa1e996d6ffcd6817bbaff4db1b/kubernetes-api-server?var-cluster=${__data.fields.cluster}&var-instance=All"}]}]}, {"matcher": {"id": "byName", "options": "Value #A"}, "properties": [{"id": "displayName", "value": "Workqueue Depth"}]}, {"matcher": {"id": "byName", "options": "Value #B"}, "properties": [{"id": "displayName", "value": "Total Reconciles"}]}, {"matcher": {"id": "byName", "options": "Value #C"}, "properties": [{"id": "displayName", "value": "Reconcile Errors"}]}]}, "gridPos": {"h": 8, "w": 12, "x": 12, "y": 17}, "id": 22, "options": {"showHeader": true}, "pluginVersion": "8.1.3", "targets": [{"exemplar": true, "expr": "sum(avg_over_time(workqueue_depth{name=\"policy-spec-sync\"}[15m])) by (cluster)", "format": "table", "instant": true, "interval": "", "legendFormat": "", "refId": "A"}, {"exemplar": true, "expr": "sum(delta(controller_runtime_reconcile_total{controller=\"policy-spec-sync\"}[15m])) by (cluster)", "format": "table", "hide": false, "instant": true, "interval": "", "legendFormat": "", "refId": "B"}, {"exemplar": true, "expr": "sum(increase(controller_runtime_reconcile_errors_total{controller=\"policy-spec-sync\"}[15m])) by (cluster)", "format": "table", "hide": false, "instant": true, "interval": "", "legendFormat": "", "refId": "C"}], "title": "Spec Sync Health", "transformations": [{"id": "labelsToFields", "options": {}}, {"id": "organize", "options": {"excludeByName": {"Time": true}, "indexByName": {}, "renameByName": {}}}, {"id": "seriesToColumns", "options": {"byField": "cluster"}}], "type": "table"}, {"datasource": "${datasource}", "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "custom": {"align": "auto", "displayMode": "auto"}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}, {"color": "red", "value": 80}]}}, "overrides": [{"matcher": {"id": "byName", "options": "Value"}, "properties": [{"id": "displayName", "value": "Compliance"}, {"id": "mappings", "value": [{"options": {"0": {"color": "green", "index": 0, "text": "Compliant"}, "1": {"color": "red", "index": 1, "text": "NonCompliant"}}, "type": "value"}]}]}]}, "gridPos": {"h": 8, "w": 12, "x": 0, "y": 24}, "id": 24, "options": {"showHeader": true}, "pluginVersion": "8.1.3", "targets": [{"exemplar": true, "expr": "policy_governance_info{type=\"propagated\", cluster_namespace=\"$cluster\"}", "format": "table", "instant": true, "interval": "", "legendFormat": "", "refId": "A"}], "title": "Policy Compliance", "transformations": [{"id": "organize", "options": {"excludeByName": {"Time": true, "__name__": true, "cluster": true, "clusterID": true, "container": true, "endpoint": true, "instance": true, "job": true, "namespace": true, "pod": true, "receive": true, "service": true, "tenant_id": true, "type": true}, "indexByName": {}, "renameByName": {}}}], "type": "table"}, {"datasource": null, "description": "", "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 0, "gradientMode": "none", "hideFrom": {"legend": false, "tooltip": false, "viz": false}, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 5, "scaleDistribution": {"type": "linear"}, "showPoints": "auto", "spanNulls": false, "stacking": {"group": "A", "mode": "none"}, "thresholdsStyle": {"mode": "off"}}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}, {"color": "red", "value": 80}]}}, "overrides": []}, "gridPos": {"h": 8, "w": 12, "x": 12, "y": 25}, "id": 4, "options": {"legend": {"calcs": [], "displayMode": "list", "placement": "bottom"}, "tooltip": {"mode": "single"}}, "targets": [{"exemplar": true, "expr": "sum(increase(controller_runtime_reconcile_total{controller=\"policy-template-sync\"}[15m]))", "instant": false, "interval": "", "legendFormat": "Reconciles", "refId": "Template Sync Reconcile Activity"}, {"exemplar": true, "expr": "sum(increase(policy_system_errors_total{service=\"governance-policy-framework-metrics\"}[15m]))", "hide": false, "instant": false, "interval": "", "legendFormat": "System Errors", "refId": "Policy Framework Errors"}, {"exemplar": true, "expr": "sum(avg_over_time(workqueue_depth{name=\"policy-template-sync\"}[15m]))", "hide": false, "instant": false, "interval": "", "legendFormat": "Workqueue Depth", "refId": "Template Sync Reconcile"}], "title": "Template Sync Health", "type": "timeseries"}, {"datasource": null, "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 0, "gradientMode": "none", "hideFrom": {"legend": false, "tooltip": false, "viz": false}, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 5, "scaleDistribution": {"type": "linear"}, "showPoints": "auto", "spanNulls": false, "stacking": {"group": "A", "mode": "none"}, "thresholdsStyle": {"mode": "off"}}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}, {"color": "red", "value": 80}]}}, "overrides": []}, "gridPos": {"h": 8, "w": 12, "x": 0, "y": 32}, "id": 18, "options": {"legend": {"calcs": [], "displayMode": "list", "placement": "bottom"}, "tooltip": {"mode": "single"}}, "targets": [{"exemplar": true, "expr": "sum(increase(controller_runtime_reconcile_total{controller=\"policy-propagator\"}[15m]))", "instant": false, "interval": "", "legendFormat": "Propagator Reconciles", "refId": "A"}, {"exemplar": true, "expr": "sum(increase(controller_runtime_reconcile_errors_total{controller=\"policy-propagator\"}[15m]))", "hide": false, "interval": "", "legendFormat": "Propagator Reconcile Errors", "refId": "B"}, {"exemplar": true, "expr": "sum(increase(controller_runtime_reconcile_total{controller=\"policy-set\"}[15m]))", "hide": true, "interval": "", "legendFormat": "PolicySet Reconciles", "refId": "C"}, {"exemplar": true, "expr": "sum(increase(controller_runtime_reconcile_errors_total{controller=\"policy-set\"}[15m]))", "hide": true, "interval": "", "legendFormat": "PolicySet Reconcile Errors", "refId": "D"}, {"exemplar": true, "expr": "sum(increase(controller_runtime_reconcile_total{controller=\"policy-encryption-keys\"}[15m]))", "hide": true, "interval": "", "legendFormat": "Encryption Key Reconciles", "refId": "E"}, {"exemplar": true, "expr": "sum(increase(controller_runtime_reconcile_errors_total{controller=\"policy-encryption-keys\"}[15m]))", "hide": true, "interval": "", "legendFormat": "Encryption Key Reconcile Errors", "refId": "F"}, {"exemplar": true, "expr": "sum(increase(controller_runtime_reconcile_total{controller=\"root-policy-status\"}[15m]))", "hide": false, "interval": "", "legendFormat": "Status Reconciles", "refId": "G"}, {"exemplar": true, "expr": "sum(increase(controller_runtime_reconcile_errors_total{controller=\"root-policy-status\"}[15m]))", "hide": false, "interval": "", "legendFormat": "Status Reconcile Errors", "refId": "H"}], "title": "Policy Propagator", "transformations": [], "type": "timeseries"}, {"datasource": null, "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 0, "gradientMode": "none", "hideFrom": {"legend": false, "tooltip": false, "viz": false}, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 5, "scaleDistribution": {"type": "linear"}, "showPoints": "auto", "spanNulls": false, "stacking": {"group": "A", "mode": "none"}, "thresholdsStyle": {"mode": "off"}}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}, {"color": "red", "value": 80}]}}, "overrides": []}, "gridPos": {"h": 8, "w": 12, "x": 12, "y": 33}, "id": 6, "options": {"legend": {"calcs": [], "displayMode": "list", "placement": "bottom"}, "tooltip": {"mode": "single"}}, "targets": [{"exemplar": true, "expr": "sum(increase(policy_system_errors_total{service=\"config-policy-controller-metrics\"}[15m]))", "instant": false, "interval": "", "legendFormat": "System Errors", "refId": "Configuration Policy System Errors"}, {"exemplar": true, "expr": "sum(increase(config_policy_evaluation_total[180s]))", "hide": false, "instant": false, "interval": "", "legendFormat": "Evaluations", "refId": "Configuration Policy Evaluations"}], "title": "Configuration Policy Health", "type": "timeseries"}], "refresh": "", "schemaVersion": 30, "style": "dark", "tags": [], "templating": {"list": [{"current": {"selected": false, "text": "Observatorium", "value": "Observatorium"}, "description": null, "error": null, "hide": 2, "includeAll": false, "label": null, "multi": false, "name": "datasource", "options": [], "query": "prometheus", "refresh": 1, "regex": "", "skipUrlSync": false, "type": "datasource"}, {"allValue": null, "current": {"selected": false, "text": "cloud", "value": "cloud"}, "datasource": null, "definition": "label_values(acm_label_names, label_name)", "description": null, "error": null, "hide": 0, "includeAll": false, "label": "Label", "multi": false, "name": "acm_label_names", "options": [], "query": {"query": "label_values(acm_label_names, label_name)", "refId": "StandardVariableQuery"}, "refresh": 1, "regex": "", "skipUrlSync": false, "sort": 1, "type": "query"}, {"allValue": null, "current": {"selected": true, "text": ["Amazon"], "value": ["Amazon"]}, "datasource": null, "definition": "label_values(acm_managed_cluster_labels, $acm_label_names)", "description": null, "error": null, "hide": 0, "includeAll": true, "label": "Value", "multi": true, "name": "value", "options": [], "query": {"query": "label_values(acm_managed_cluster_labels, $acm_label_names)", "refId": "StandardVariableQuery"}, "refresh": 1, "regex": "", "skipUrlSync": false, "sort": 0, "type": "query"}, {"allValue": null, "current": {"selected": true, "text": ["development"], "value": ["development"]}, "datasource": "${datasource}", "definition": "label_values(cluster)", "description": null, "error": null, "hide": 0, "includeAll": false, "label": "Cluster", "multi": false, "name": "cluster", "options": [], "query": {"query": "label_values(cluster)", "refId": "StandardVariableQuery"}, "refresh": 2, "regex": "", "skipUrlSync": false, "sort": 1, "type": "query"}]}, "time": {"from": "now-12h", "to": "now"}, "timepicker": {}, "timezone": "", "title": "Policy Framework Dashboard", "version": 37}
